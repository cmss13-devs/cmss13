<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/controller/subsystem/cmtv - byond</title></head><body><header><a href="index.html">byond</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/controller/subsystem/cmtv.html#var">Var Details</a> - <a href="datum/controller/subsystem/cmtv.html#proc">Proc Details</a></header><main><h1>CMTV <aside>/<a href="datum.html">datum</a>/<a href="datum/controller/subsystem.html">controller/subsystem</a>/<a href="datum/controller/subsystem/cmtv.html">cmtv</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L5"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 5"></a></h1><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/camera_mob">camera_mob</a></th><td>For convenience, a reference to their camera mob</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/camera_operator">camera_operator</a></th><td>Our perspective, based on a specific ckey, either found in init
or post-join via DCS</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/current_perspective">current_perspective</a></th><td>A hardref to the person we are currently watching,
with a bunch of signals subscribed.</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/future_perspective">future_perspective</a></th><td>A weakref of who we will be switching to after the delay
to ensure they can cancel, if they want to.</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/minimum_screentime">minimum_screentime</a></th><td>How long until we should start polling to change perspective
excluding mobs dying or other factors that make a mob ineligible
based on DCS</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/next_show_time">next_show_time</a></th><td>How long our next contestant will be shown for</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/opted_out_ckeys">opted_out_ckeys</a></th><td>Ckeys that have opted out -&gt; when they opted outs. If within the last 5 minutes, they're excluded</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/priority_list">priority_list</a></th><td>The cached list of priority groups for observing. This is
used so we can ensure we're only switching perspective
if there is someone more interesting to watch instead.</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/subscribers">subscribers</a></th><td>List of subscriber IDs, retrieved from the cmtv_api endpoint</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/switch_at">switch_at</a></th><td>The time that we should switch to our new perspective</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/temporarily_observing_turf">temporarily_observing_turf</a></th><td>While we're currently checking out a different turf, the time remaining till we switch back</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#var/to_switch_to">to_switch_to</a></th><td>Who we should check out when we're finished observing turfs. Can be null, or a hardref to a mob</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/change_observed_mob">change_observed_mob</a></th><td>Takes a new mob to observe. If there is already a queued up mob, or a current perspective, they will be notified and dropped. This will become the new perspective in 10 seconds.
If set to instant, we immediately switch to observe nothing. If set_showtime is set, the camera will stay on the new perspective for at least this long,
unless they die or something.</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/do_init_chat">do_init_chat</a></th><td>To ensure the chat is fully initialised after we nuke it, we wait a bit before sending it an action</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/get_active_player">get_active_player</a></th><td>From the cached priority list, pulls an active player in priority order</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/get_active_priority_player_list">get_active_priority_player_list</a></th><td>Returns a list of weakrefs of mobs in certain priority groups. Priority 1 are active combatants, Priority 2 are mobs that are active and on the
groundmap (except in hijack, where they must just be active) and Priority 3 are mobs that are, at least, active.</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/get_most_active_list">get_most_active_list</a></th><td>Returns the mob list with the greatest priority. If there are priority 1 mobs, it will return that list, even if there is only one.</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/handle_new_camera">handle_new_camera</a></th><td>Sets up the camera client, including assigning a new mob, making it widescreen, winsetting() for clarity</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/handle_new_client">handle_new_client</a></th><td>Signal handler for if the client disconnects/rejoins midround</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/handle_reset_signal">handle_reset_signal</a></th><td>Generic reset handler, will keep the perspective on the old mob till the new one accepts</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/handle_reset_signal_immediate">handle_reset_signal_immediate</a></th><td>Reset handler that immediately switches perspective to something generic while we wait</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/handle_roundstart">handle_roundstart</a></th><td>For events we want to occur at the beginning of the round - eg, when the map becomes actually visible</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/handle_z_change">handle_z_change</a></th><td>Signal handler - it might be dull if a player wanders off to medical on the ship.</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/is_active">is_active</a></th><td>If a player is still categorised as being active</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/is_combatant">is_combatant</a></th><td>Checks if the latest <a href="datum.html" title="/datum">/datum/cause_data</a> was generated within the given delay_time</td></tr><tr><th><a href="datum/controller/subsystem/cmtv.html#proc/reset_perspective">reset_perspective</a></th><td>Generic signal handler for deaths, nestings, logouts, etc. Immediately queues up a new perspective to be switched to</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/camera_mob"><aside class="declaration">var </aside>camera_mob <aside>– /<a href="mob.html">mob</a>/<a href="mob/dead/observer.html">dead/observer</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L15"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 15"></a></h3><p>For convenience, a reference to their camera mob</p><h3 id="var/camera_operator"><aside class="declaration">var </aside>camera_operator <aside>– /<a href="client.html">client</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L12"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 12"></a></h3><p>Our perspective, based on a specific ckey, either found in init
or post-join via DCS</p><h3 id="var/current_perspective"><aside class="declaration">var </aside>current_perspective <aside>– /<a href="mob.html">mob</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L19"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 19"></a></h3><p>A hardref to the person we are currently watching,
with a bunch of signals subscribed.</p><h3 id="var/future_perspective"><aside class="declaration">var </aside>future_perspective <aside>– /<a href="datum.html">datum</a>/weakref</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L23"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 23"></a></h3><p>A weakref of who we will be switching to after the delay
to ensure they can cancel, if they want to.</p><h3 id="var/minimum_screentime"><aside class="declaration">var </aside>minimum_screentime <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L41"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 41"></a></h3><p>How long until we should start polling to change perspective
excluding mobs dying or other factors that make a mob ineligible
based on DCS</p><h3 id="var/next_show_time"><aside class="declaration">var </aside>next_show_time <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L29"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 29"></a></h3><p>How long our next contestant will be shown for</p><h3 id="var/opted_out_ckeys"><aside class="declaration">var </aside>opted_out_ckeys <aside>– /alist</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L50"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 50"></a></h3><p>Ckeys that have opted out -&gt; when they opted outs. If within the last 5 minutes, they're excluded</p><h3 id="var/priority_list"><aside class="declaration">var </aside>priority_list <aside>– /list</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L34"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 34"></a></h3><p>The cached list of priority groups for observing. This is
used so we can ensure we're only switching perspective
if there is someone more interesting to watch instead.</p><h3 id="var/subscribers"><aside class="declaration">var </aside>subscribers <aside>– /list</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L53"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 53"></a></h3><p>List of subscriber IDs, retrieved from the cmtv_api endpoint</p><h3 id="var/switch_at"><aside class="declaration">var </aside>switch_at <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L26"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 26"></a></h3><p>The time that we should switch to our new perspective</p><h3 id="var/temporarily_observing_turf"><aside class="declaration">var </aside>temporarily_observing_turf <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L44"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 44"></a></h3><p>While we're currently checking out a different turf, the time remaining till we switch back</p><h3 id="var/to_switch_to"><aside class="declaration">var </aside>to_switch_to <aside>– /<a href="datum.html">datum</a>/weakref</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L47"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 47"></a></h3><p>Who we should check out when we're finished observing turfs. Can be null, or a hardref to a mob</p><h2 id="proc">Proc Details</h2><h3 id="proc/change_observed_mob"><aside class="declaration">proc </aside>change_observed_mob<aside>(/<a href="mob.html">mob</a>/new_perspective, instant_switch_away, instant_switch_to, set_showtime, change_reason)  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L226"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 226"></a></aside></h3><p>Takes a new mob to observe. If there is already a queued up mob, or a current perspective, they will be notified and dropped. This will become the new perspective in 10 seconds.
If set to instant, we immediately switch to observe nothing. If set_showtime is set, the camera will stay on the new perspective for at least this long,
unless they die or something.</p><h3 id="proc/do_init_chat"><aside class="declaration">proc </aside>do_init_chat<aside>()  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L219"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 219"></a></aside></h3><p>To ensure the chat is fully initialised after we nuke it, we wait a bit before sending it an action</p><h3 id="proc/get_active_player"><aside class="declaration">proc </aside>get_active_player<aside>()  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L537"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 537"></a></aside></h3><p>From the cached priority list, pulls an active player in priority order</p><h3 id="proc/get_active_priority_player_list"><aside class="declaration">proc </aside>get_active_priority_player_list<aside>()  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L517"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 517"></a></aside></h3><p>Returns a list of weakrefs of mobs in certain priority groups. Priority 1 are active combatants, Priority 2 are mobs that are active and on the
groundmap (except in hijack, where they must just be active) and Priority 3 are mobs that are, at least, active.</p><h3 id="proc/get_most_active_list"><aside class="declaration">proc </aside>get_most_active_list<aside>()  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L558"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 558"></a></aside></h3><p>Returns the mob list with the greatest priority. If there are priority 1 mobs, it will return that list, even if there is only one.</p><h3 id="proc/handle_new_camera"><aside class="declaration">proc </aside>handle_new_camera<aside>(/<a href="client.html">client</a>/camera_operator, round_start)  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L153"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 153"></a></aside></h3><p>Sets up the camera client, including assigning a new mob, making it widescreen, winsetting() for clarity</p><h3 id="proc/handle_new_client"><aside class="declaration">proc </aside>handle_new_client<aside>(SSdcs, /<a href="client.html">client</a>/new_client)  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L143"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 143"></a></aside></h3><p>Signal handler for if the client disconnects/rejoins midround</p><h3 id="proc/handle_reset_signal"><aside class="declaration">proc </aside>handle_reset_signal<aside>()  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L359"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 359"></a></aside></h3><p>Generic reset handler, will keep the perspective on the old mob till the new one accepts</p><h3 id="proc/handle_reset_signal_immediate"><aside class="declaration">proc </aside>handle_reset_signal_immediate<aside>()  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L365"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 365"></a></aside></h3><p>Reset handler that immediately switches perspective to something generic while we wait</p><h3 id="proc/handle_roundstart"><aside class="declaration">proc </aside>handle_roundstart<aside>()  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L208"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 208"></a></aside></h3><p>For events we want to occur at the beginning of the round - eg, when the map becomes actually visible</p><h3 id="proc/handle_z_change"><aside class="declaration">proc </aside>handle_z_change<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/moving, old_z, new_z)  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L343"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 343"></a></aside></h3><p>Signal handler - it might be dull if a player wanders off to medical on the ship.</p><h3 id="proc/is_active"><aside class="declaration">proc </aside>is_active<aside>(/<a href="mob.html">mob</a>/possible_player, delay_time)  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L571"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 571"></a></aside></h3><p>If a player is still categorised as being active</p><h3 id="proc/is_combatant"><aside class="declaration">proc </aside>is_combatant<aside>(/<a href="mob.html">mob</a>/possible_combatant, delay_time)  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L603"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 603"></a></aside></h3><p>Checks if the latest <a href="datum.html" title="/datum">/datum/cause_data</a> was generated within the given delay_time</p><h3 id="proc/reset_perspective"><aside class="declaration">proc </aside>reset_perspective<aside>(reason, instant)  <a href="https://github.com/cmss13-devs/cmss13/blob/1ce601c8c1c984080a82f42b65ce9ee6b48f00da/code/controllers/subsystem/cmtv.dm#L407"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/cmtv.dm 407"></a></aside></h3><p>Generic signal handler for deaths, nestings, logouts, etc. Immediately queues up a new perspective to be switched to</p></main><footer>colonialmarines.dme <a href="https://github.com/cmss13-devs/cmss13/tree/1ce601c8c1c984080a82f42b65ce9ee6b48f00da">1ce601c</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>