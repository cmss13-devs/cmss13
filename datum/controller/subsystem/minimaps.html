<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><base href="../../../"><link rel="stylesheet" href="dmdoc.css"><title>/datum/controller/subsystem/minimaps - byond</title></head><body><header><a href="index.html">byond</a> - <a href="index.html#modules">Modules</a> - <a href="index.html#types">Types</a> — <a href="datum/controller/subsystem/minimaps.html#var">Var Details</a> - <a href="datum/controller/subsystem/minimaps.html#proc">Proc Details</a></header><main><h1>Minimaps <aside>/<a href="datum.html">datum</a>/<a href="datum/controller/subsystem.html">controller/subsystem</a>/<a href="datum/controller/subsystem/minimaps.html">minimaps</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L25"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 25"></a></h1><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/drawn_images">drawn_images</a></th><td>assoc list of hash = image of images drawn by players</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/earlyadds">earlyadds</a></th><td>list of callbacks we need to invoke late because Initialize happens early, or a Z-level was loaded after init</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/hashed_minimaps">hashed_minimaps</a></th><td>assoc list of minimap objects that are hashed so we have to update as few as possible</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/images_by_source">images_by_source</a></th><td>Assoc list of images we hold by their source</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/minimaps_by_z">minimaps_by_z</a></th><td>Minimap hud display datums sorted by zlevel</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/removal_cbs">removal_cbs</a></th><td>Assoc list of removal callbacks to invoke to remove images from the raw lists</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/update_targets">update_targets</a></th><td>the update target datums, sorted by update flag type</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/update_targets_unsorted">update_targets_unsorted</a></th><td>Nonassoc list of updators we want to have their overlays reapplied</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#var/updators_by_datum">updators_by_datum</a></th><td>list of holders for data relating to tracked zlevel and tracked atum</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/add_marker">add_marker</a></th><td>Adds an atom we want to track with blips to the subsystem
Arguments:</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/add_to_updaters">add_to_updaters</a></th><td>Adds an atom to the processing updators that will have blips drawn on them
Arguments:</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/fetch_minimap_object">fetch_minimap_object</a></th><td>Fetches a /atom/movable/screen/minimap instance or creates on if none exists
Note this does not destroy them when the map is unused, might be a potential thing to do?
Arguments:</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/get_drawing_image">get_drawing_image</a></th><td>fetches the drawing icon for a minimap flag and returns it, creating it if needed. assumes minimap_flag is ONE flag</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/has_marker">has_marker</a></th><td>Checks if the source has a marker already set</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/load_new_z">load_new_z</a></th><td>Creates a minimap for a particular z level</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/on_z_change">on_z_change</a></th><td>Called on zlevel change of a blip-atom so we can update the image lists as needed</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/remove_earlyadd">remove_earlyadd</a></th><td>Removes the object from the earlyadds list, in case it was qdel'd before the z-level was fully loaded</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/remove_marker">remove_marker</a></th><td>Removes an atom and it's blip from the subsystem</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/remove_updator">remove_updator</a></th><td>Removes a atom from the subsystems updating overlays</td></tr><tr><th><a href="datum/controller/subsystem/minimaps.html#proc/removeimage">removeimage</a></th><td>removes an image from raw tracked lists, invoked by callback</td></tr></table><h2 id="var">Var Details</h2><h3 id="var/drawn_images"><aside class="declaration">var </aside>drawn_images <aside>– /list/<a href="image.html">image</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L44"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 44"></a></h3><p>assoc list of hash = image of images drawn by players</p><h3 id="var/earlyadds"><aside class="declaration">var </aside>earlyadds <aside>– /list/list/<a href="datum.html">datum</a>/callback</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L46"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 46"></a></h3><p>list of callbacks we need to invoke late because Initialize happens early, or a Z-level was loaded after init</p><h3 id="var/hashed_minimaps"><aside class="declaration">var </aside>hashed_minimaps <aside>– /list</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L48"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 48"></a></h3><p>assoc list of minimap objects that are hashed so we have to update as few as possible</p><h3 id="var/images_by_source"><aside class="declaration">var </aside>images_by_source <aside>– /list/<a href="image.html">image</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L34"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 34"></a></h3><p>Assoc list of images we hold by their source</p><h3 id="var/minimaps_by_z"><aside class="declaration">var </aside>minimaps_by_z <aside>– /list/<a href="datum.html">datum</a>/<a href="datum/hud_displays.html">hud_displays</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L32"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 32"></a></h3><p>Minimap hud display datums sorted by zlevel</p><h3 id="var/removal_cbs"><aside class="declaration">var </aside>removal_cbs <aside>– /list/<a href="datum.html">datum</a>/callback</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L40"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 40"></a></h3><p>Assoc list of removal callbacks to invoke to remove images from the raw lists</p><h3 id="var/update_targets"><aside class="declaration">var </aside>update_targets <aside>– /list</aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L36"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 36"></a></h3><p>the update target datums, sorted by update flag type</p><h3 id="var/update_targets_unsorted"><aside class="declaration">var </aside>update_targets_unsorted <aside>– /list/<a href="datum.html">datum</a>/<a href="datum/minimap_updator.html">minimap_updator</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L38"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 38"></a></h3><p>Nonassoc list of updators we want to have their overlays reapplied</p><h3 id="var/updators_by_datum"><aside class="declaration">var </aside>updators_by_datum <aside>– /list/<a href="datum.html">datum</a>/<a href="datum/minimap_updator.html">minimap_updator</a></aside> <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L42"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 42"></a></h3><p>list of holders for data relating to tracked zlevel and tracked atum</p><h2 id="proc">Proc Details</h2><h3 id="proc/add_marker"><aside class="declaration">proc </aside>add_marker<aside>(/<a href="atom.html">atom</a>/target, hud_flags, /<a href="image.html">image</a>/blip, image_x, image_y, is_label)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L258"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 258"></a></aside></h3><p>Adds an atom we want to track with blips to the subsystem
Arguments:</p>
<ul>
<li>target: atom we want to track</li>
<li>hud_flags: tracked HUDs we want this atom to be displayed on</li>
<li>marker: image or mutable_appearance we want to be using on the map</li>
</ul><h3 id="proc/add_to_updaters"><aside class="declaration">proc </aside>add_to_updaters<aside>(/<a href="atom.html">atom</a>/target, flags, ztarget, drawing, labels)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L170"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 170"></a></aside></h3><p>Adds an atom to the processing updators that will have blips drawn on them
Arguments:</p>
<ul>
<li>target: the target we want to be updating the overlays on</li>
<li>flags: flags for the types of blips we want to be updated</li>
<li>ztarget: zlevel we want to be updated with</li>
</ul><h3 id="proc/fetch_minimap_object"><aside class="declaration">proc </aside>fetch_minimap_object<aside>(zlevel, flags, live, popup, drawing)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L426"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 426"></a></aside></h3><p>Fetches a /atom/movable/screen/minimap instance or creates on if none exists
Note this does not destroy them when the map is unused, might be a potential thing to do?
Arguments:</p>
<ul>
<li>zlevel: zlevel to fetch map for</li>
<li>flags: map flags to fetch from</li>
</ul><h3 id="proc/get_drawing_image"><aside class="declaration">proc </aside>get_drawing_image<aside>(zlevel, minimap_flag, drawing)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L437"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 437"></a></aside></h3><p>fetches the drawing icon for a minimap flag and returns it, creating it if needed. assumes minimap_flag is ONE flag</p><h3 id="proc/has_marker"><aside class="declaration">proc </aside>has_marker<aside>(/<a href="atom.html">atom</a>/source)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L402"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 402"></a></aside></h3><p>Checks if the source has a marker already set</p><h3 id="proc/load_new_z"><aside class="declaration">proc </aside>load_new_z<aside>(/<a href="datum.html">datum</a>/dcs, /<a href="datum.html">datum</a>/<a href="datum/space_level.html">space_level</a>/z_level)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L89"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 89"></a></aside></h3><p>Creates a minimap for a particular z level</p><h3 id="proc/on_z_change"><aside class="declaration">proc </aside>on_z_change<aside>(/<a href="atom.html">atom</a>/<a href="atom/movable.html">movable</a>/source, oldz, newz)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L333"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 333"></a></aside></h3><p>Called on zlevel change of a blip-atom so we can update the image lists as needed</p>
<p>TODO gross amount of assoc usage and unneeded ALL FLAGS iteration</p><h3 id="proc/remove_earlyadd"><aside class="declaration">proc </aside>remove_earlyadd<aside>(/<a href="atom.html">atom</a>/source)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L298"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 298"></a></aside></h3><p>Removes the object from the earlyadds list, in case it was qdel'd before the z-level was fully loaded</p><h3 id="proc/remove_marker"><aside class="declaration">proc </aside>remove_marker<aside>(/<a href="atom.html">atom</a>/source)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L388"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 388"></a></aside></h3><p>Removes an atom and it's blip from the subsystem</p><h3 id="proc/remove_updator"><aside class="declaration">proc </aside>remove_updator<aside>(/<a href="atom.html">atom</a>/target)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L190"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 190"></a></aside></h3><p>Removes a atom from the subsystems updating overlays</p><h3 id="proc/removeimage"><aside class="declaration">proc </aside>removeimage<aside>(/<a href="image.html">image</a>/blip, /<a href="atom.html">atom</a>/target, hud_flags)  <a href="https://github.com/cmss13-devs/cmss13/blob/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9/code/controllers/subsystem/minimap.dm#L314"><img src="git.png" width="16" height="16" title="code/controllers/subsystem/minimap.dm 314"></a></aside></h3><p>removes an image from raw tracked lists, invoked by callback</p></main><footer>colonialmarines.dme <a href="https://github.com/cmss13-devs/cmss13/tree/ce4ac86508e4d56788cbf9a38fa95a3f28a3e2f9">ce4ac86</a> (master) — <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/crates/dmdoc/README.md">dmdoc 1.11.0</a></footer></body></html>