!function(){var e={8397:function(e,t){"use strict";t.__esModule=!0,t.Color=void 0;var n=1e-4,o=function(){function e(e,t,n,o){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=1),this.r=e,this.g=t,this.b=n,this.a=o}return e.prototype.toString=function(){return"rgba("+(0|this.r)+", "+(0|this.g)+", "+(0|this.b)+", "+(0|this.a)+")"},e}();t.Color=o,o.fromHex=function(e){return new o(parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16))},o.lerp=function(e,t,n){return new o((t.r-e.r)*n+e.r,(t.g-e.g)*n+e.g,(t.b-e.b)*n+e.b,(t.a-e.a)*n+e.a)},o.lookup=function(e,t){void 0===t&&(t=[]);var r=t.length;if(r<2)throw new Error("Needs at least two colors!");var i=e*(r-1);if(e<n)return t[0];if(e>=.9999)return t[r-1];var a=i%1,c=0|i;return o.lerp(t[c],t[c+1],a)}},54549:function(e,t,n){"use strict";t.__esModule=!0,t.Notifications=void 0;var o=n(39812),r=n(74814),i=function(e){var t=e.children;return(0,o.createVNode)(1,"div","Notifications",t,0)};t.Notifications=i;i.Item=function(e){var t=e.rightSlot,n=e.children;return(0,o.createComponentVNode)(2,r.Flex,{align:"center",className:"Notification",children:[(0,o.createComponentVNode)(2,r.Flex.Item,{className:"Notification__content",grow:1,children:n}),t&&(0,o.createComponentVNode)(2,r.Flex.Item,{className:"Notification__rightSlot",children:t})]})}},33154:function(e,t,n){"use strict";t.__esModule=!0,t.Panel=void 0;var o=n(39812),r=n(74814),i=n(85952),a=n(34058),c=n(62225),s=n(64398),l=n(54549),d=n(77965),u=n(67206);t.Panel=function(e,t){if(Byond.IS_LTE_IE10)return(0,o.createComponentVNode)(2,g);var n=(0,a.useAudio)(t),h=(0,u.useSettings)(t),p=(0,s.useGame)(t);return(0,o.createComponentVNode)(2,i.Pane,{theme:h.theme,children:(0,o.createComponentVNode)(2,r.Stack,{fill:!0,vertical:!0,children:[(0,o.createComponentVNode)(2,r.Stack.Item,{children:(0,o.createComponentVNode)(2,r.Section,{fitted:!0,children:(0,o.createComponentVNode)(2,r.Stack,{mr:1,align:"center",children:[(0,o.createComponentVNode)(2,r.Stack.Item,{grow:!0,overflowX:"auto",children:(0,o.createComponentVNode)(2,c.ChatTabs)}),(0,o.createComponentVNode)(2,r.Stack.Item,{children:(0,o.createComponentVNode)(2,d.PingIndicator)}),(0,o.createComponentVNode)(2,r.Stack.Item,{children:(0,o.createComponentVNode)(2,r.Button,{color:"grey",selected:n.visible,icon:"music",tooltip:"Music player",tooltipPosition:"bottom-left",onClick:function(){return n.toggle()}})}),(0,o.createComponentVNode)(2,r.Stack.Item,{children:(0,o.createComponentVNode)(2,r.Button,{icon:h.visible?"times":"cog",selected:h.visible,tooltip:h.visible?"Close settings":"Open settings",tooltipPosition:"bottom-left",onClick:function(){return h.toggle()}})})]})})}),n.visible&&(0,o.createComponentVNode)(2,r.Stack.Item,{children:(0,o.createComponentVNode)(2,r.Section,{children:(0,o.createComponentVNode)(2,a.NowPlayingWidget)})}),h.visible&&(0,o.createComponentVNode)(2,r.Stack.Item,{children:(0,o.createComponentVNode)(2,u.SettingsPanel)}),(0,o.createComponentVNode)(2,r.Stack.Item,{grow:!0,children:(0,o.createComponentVNode)(2,r.Section,{fill:!0,fitted:!0,position:"relative",children:[(0,o.createComponentVNode)(2,i.Pane.Content,{scrollable:!0,children:(0,o.createComponentVNode)(2,c.ChatPanel,{lineHeight:h.lineHeight})}),(0,o.createComponentVNode)(2,l.Notifications,{children:[p.connectionLostAt&&(0,o.createComponentVNode)(2,l.Notifications.Item,{rightSlot:(0,o.createComponentVNode)(2,r.Button,{color:"white",onClick:function(){return Byond.command(".reconnect")},children:"Reconnect"}),children:"You are either AFK, experiencing lag or the connection has closed."}),p.roundRestartedAt&&(0,o.createComponentVNode)(2,l.Notifications.Item,{children:"The connection has been closed because the server is restarting. Please wait while you automatically reconnect."})]})]})})]})})};var g=function(e,t){var n=(0,u.useSettings)(t);return(0,o.createComponentVNode)(2,i.Pane,{theme:n.theme,children:(0,o.createComponentVNode)(2,i.Pane.Content,{scrollable:!0,children:[(0,o.createComponentVNode)(2,r.Button,{style:{position:"fixed",top:"1em",right:"2em","z-index":1e3},selected:n.visible,onClick:function(){return n.toggle()},children:"Settings"}),n.visible&&(0,o.createComponentVNode)(2,u.SettingsPanel)||(0,o.createComponentVNode)(2,c.ChatPanel,{lineHeight:n.lineHeight})]})})}},79397:function(e,t,n){"use strict";t.__esModule=!0,t.NowPlayingWidget=void 0;var o=n(39812),r=n(94187),i=n(25526),a=n(74814),c=n(67206),s=n(64e3);t.NowPlayingWidget=function(e,t){var n,l=(0,i.useSelector)(t,s.selectAudio),d=(0,i.useDispatch)(t),u=(0,c.useSettings)(t),g=null==(n=l.meta)?void 0:n.title;return(0,o.createComponentVNode)(2,a.Flex,{align:"center",children:[l.playing&&(0,o.createFragment)([(0,o.createComponentVNode)(2,a.Flex.Item,{shrink:0,mx:.5,color:"label",children:"Now playing:"}),(0,o.createComponentVNode)(2,a.Flex.Item,{mx:.5,grow:1,style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis"},children:g||"Unknown Track"})],4)||(0,o.createComponentVNode)(2,a.Flex.Item,{grow:1,color:"label",children:"Nothing to play."}),l.playing&&(0,o.createComponentVNode)(2,a.Flex.Item,{mx:.5,fontSize:"0.9em",children:(0,o.createComponentVNode)(2,a.Button,{tooltip:"Stop",icon:"stop",onClick:function(){return d({type:"audio/stopMusic"})}})}),(0,o.createComponentVNode)(2,a.Flex.Item,{mx:.5,fontSize:"0.9em",children:(0,o.createComponentVNode)(2,a.Knob,{minValue:0,maxValue:1,value:u.adminMusicVolume,step:.0025,stepPixelSize:1,format:function(e){return(0,r.toFixed)(100*e)+"%"},onDrag:function(e,t){return u.update({adminMusicVolume:t})}})})]})}},22152:function(e,t,n){"use strict";t.__esModule=!0,t.useAudio=void 0;var o=n(25526),r=n(64e3);t.useAudio=function(e){var t=(0,o.useSelector)(e,r.selectAudio),n=(0,o.useDispatch)(e);return Object.assign({},t,{toggle:function(){return n({type:"audio/toggle"})}})}},34058:function(e,t,n){"use strict";t.__esModule=!0,t.audioReducer=t.NowPlayingWidget=t.audioMiddleware=t.useAudio=void 0;var o=n(22152);t.useAudio=o.useAudio;var r=n(50801);t.audioMiddleware=r.audioMiddleware;var i=n(79397);t.NowPlayingWidget=i.NowPlayingWidget;var a=n(37750);t.audioReducer=a.audioReducer},50801:function(e,t,n){"use strict";t.__esModule=!0,t.audioMiddleware=void 0;var o=n(11929);t.audioMiddleware=function(e){var t=new o.AudioPlayer;return t.onPlay((function(){e.dispatch({type:"audio/playing"})})),t.onStop((function(){e.dispatch({type:"audio/stopped"})})),function(e){return function(n){var o=n.type,r=n.payload;if("audio/playMusic"===o){var i=r.url,a=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(r,["url"]);return t.play(i,a),e(n)}if("audio/stopMusic"===o)return t.stop(),e(n);if("settings/update"===o||"settings/load"===o){var c=null==r?void 0:r.adminMusicVolume;return"number"==typeof c&&t.setVolume(c),e(n)}return e(n)}}}},11929:function(e,t,n){"use strict";function o(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}t.__esModule=!0,t.AudioPlayer=void 0;var i=(0,n(88654).createLogger)("AudioPlayer"),a=function(){function e(){var e=this;Byond.IS_LTE_IE9||(this.node=document.createElement("audio"),this.node.style.setProperty("display","none"),document.body.appendChild(this.node),this.playing=!1,this.volume=1,this.options={},this.onPlaySubscribers=[],this.onStopSubscribers=[],this.node.addEventListener("canplaythrough",(function(){i.log("canplaythrough"),e.playing=!0,e.node.playbackRate=e.options.pitch||1,e.node.currentTime=e.options.start||0,e.node.volume=e.volume,e.node.play();for(var t,n=o(e.onPlaySubscribers);!(t=n()).done;){(0,t.value)()}})),this.node.addEventListener("ended",(function(){i.log("ended"),e.stop()})),this.node.addEventListener("error",(function(t){e.playing&&(i.log("playback error",t.error),e.stop())})),this.playbackInterval=setInterval((function(){e.playing&&(e.options.end>0&&e.node.currentTime>=e.options.end&&e.stop())}),1e3))}var t=e.prototype;return t.destroy=function(){this.node&&(this.node.stop(),document.removeChild(this.node),clearInterval(this.playbackInterval))},t.play=function(e,t){void 0===t&&(t={}),this.node&&(i.log("playing",e,t),this.options=t,this.node.src=e)},t.stop=function(){if(this.node){if(this.playing)for(var e,t=o(this.onStopSubscribers);!(e=t()).done;)(0,e.value)();i.log("stopping"),this.playing=!1,this.node.src=""}},t.setVolume=function(e){this.node&&(this.volume=e,this.node.volume=e)},t.onPlay=function(e){this.node&&this.onPlaySubscribers.push(e)},t.onStop=function(e){this.node&&this.onStopSubscribers.push(e)},e}();t.AudioPlayer=a},37750:function(e,t){"use strict";t.__esModule=!0,t.audioReducer=void 0;var n={visible:!1,playing:!1,track:null};t.audioReducer=function(e,t){void 0===e&&(e=n);var o=t.type,r=t.payload;return"audio/playing"===o?Object.assign({},e,{visible:!0,playing:!0}):"audio/stopped"===o?Object.assign({},e,{visible:!1,playing:!1}):"audio/playMusic"===o?Object.assign({},e,{meta:r}):"audio/stopMusic"===o?Object.assign({},e,{visible:!1,playing:!1,meta:null}):"audio/toggle"===o?Object.assign({},e,{visible:!e.visible}):e}},64e3:function(e,t){"use strict";t.__esModule=!0,t.selectAudio=void 0;t.selectAudio=function(e){return e.audio}},56482:function(e,t,n){"use strict";t.__esModule=!0,t.ChatPageSettings=void 0;var o=n(39812),r=n(25526),i=n(74814),a=n(7041),c=n(44621),s=n(95040);t.ChatPageSettings=function(e,t){var n=(0,r.useSelector)(t,s.selectCurrentChatPage),l=(0,r.useDispatch)(t);return(0,o.createComponentVNode)(2,i.Section,{children:[(0,o.createComponentVNode)(2,i.Stack,{align:"center",children:[(0,o.createComponentVNode)(2,i.Stack.Item,{grow:1,children:(0,o.createComponentVNode)(2,i.Input,{fluid:!0,value:n.name,onChange:function(e,t){return l((0,a.updateChatPage)({pageId:n.id,name:t}))}})}),(0,o.createComponentVNode)(2,i.Stack.Item,{children:(0,o.createComponentVNode)(2,i.Button,{icon:"times",color:"red",onClick:function(){return l((0,a.removeChatPage)({pageId:n.id}))},children:"Remove"})})]}),(0,o.createComponentVNode)(2,i.Divider),(0,o.createComponentVNode)(2,i.Section,{title:"Messages to display",level:2,children:[c.MESSAGE_TYPES.filter((function(e){return!e.important&&!e.admin})).map((function(e){return(0,o.createComponentVNode)(2,i.Button.Checkbox,{checked:n.acceptedTypes[e.type],onClick:function(){return l((0,a.toggleAcceptedType)({pageId:n.id,type:e.type}))},children:e.name},e.type)})),(0,o.createComponentVNode)(2,i.Collapsible,{mt:1,color:"transparent",title:"Admin stuff",children:c.MESSAGE_TYPES.filter((function(e){return!e.important&&e.admin})).map((function(e){return(0,o.createComponentVNode)(2,i.Button.Checkbox,{checked:n.acceptedTypes[e.type],onClick:function(){return l((0,a.toggleAcceptedType)({pageId:n.id,type:e.type}))},children:e.name},e.type)}))})]})]})}},83884:function(e,t,n){"use strict";t.__esModule=!0,t.ChatPanel=void 0;var o=n(39812),r=n(34380),i=n(74814),a=n(86474);function c(e,t){return(c=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var s=function(e){var t,n;function s(){var t;return(t=e.call(this)||this).ref=(0,o.createRef)(),t.state={scrollTracking:!0},t.handleScrollTrackingChange=function(e){return t.setState({scrollTracking:e})},t}n=e,(t=s).prototype=Object.create(n.prototype),t.prototype.constructor=t,c(t,n);var l=s.prototype;return l.componentDidMount=function(){a.chatRenderer.mount(this.ref.current),a.chatRenderer.events.on("scrollTrackingChanged",this.handleScrollTrackingChange),this.componentDidUpdate()},l.componentWillUnmount=function(){a.chatRenderer.events.off("scrollTrackingChanged",this.handleScrollTrackingChange)},l.componentDidUpdate=function(e){requestAnimationFrame((function(){a.chatRenderer.ensureScrollTracking()})),(!e||(0,r.shallowDiffers)(this.props,e))&&a.chatRenderer.assignStyle({width:"100%","white-space":"pre-wrap","font-size":this.props.fontSize,"line-height":this.props.lineHeight})},l.render=function(){var e=this.state.scrollTracking;return(0,o.createFragment)([(0,o.createVNode)(1,"div","Chat",null,1,null,null,this.ref),!e&&(0,o.createComponentVNode)(2,i.Button,{className:"Chat__scrollButton",icon:"arrow-down",onClick:function(){return a.chatRenderer.scrollToBottom()},children:"Scroll to bottom"})],0)},s}(o.Component);t.ChatPanel=s},46688:function(e,t,n){"use strict";t.__esModule=!0,t.ChatTabs=void 0;var o=n(39812),r=n(25526),i=n(74814),a=n(7041),c=n(95040),s=n(19604),l=function(e){var t=e.value;return(0,o.createComponentVNode)(2,i.Box,{style:{"font-size":"0.7em","border-radius":"0.25em",width:"1.7em","line-height":"1.55em","background-color":"crimson",color:"#fff"},children:Math.min(t,99)})};t.ChatTabs=function(e,t){var n=(0,r.useSelector)(t,c.selectChatPages),d=(0,r.useSelector)(t,c.selectCurrentChatPage),u=(0,r.useDispatch)(t);return(0,o.createComponentVNode)(2,i.Flex,{align:"center",children:[(0,o.createComponentVNode)(2,i.Flex.Item,{children:(0,o.createComponentVNode)(2,i.Tabs,{textAlign:"center",children:n.map((function(e){return(0,o.createComponentVNode)(2,i.Tabs.Tab,{selected:e===d,rightSlot:e.unreadCount>0&&(0,o.createComponentVNode)(2,l,{value:e.unreadCount}),onClick:function(){return u((0,a.changeChatPage)({pageId:e.id}))},children:e.name},e.id)}))})}),(0,o.createComponentVNode)(2,i.Flex.Item,{ml:1,children:(0,o.createComponentVNode)(2,i.Button,{color:"transparent",icon:"plus",onClick:function(){u((0,a.addChatPage)()),u((0,s.openChatSettings)())}})})]})}},7041:function(e,t,n){"use strict";t.__esModule=!0,t.saveChatToDisk=t.changeScrollTracking=t.removeChatPage=t.toggleAcceptedType=t.updateChatPage=t.changeChatPage=t.addChatPage=t.updateMessageCount=t.rebuildChat=t.loadChat=void 0;var o=n(25526),r=n(31737),i=(0,o.createAction)("chat/load");t.loadChat=i;var a=(0,o.createAction)("chat/rebuild");t.rebuildChat=a;var c=(0,o.createAction)("chat/updateMessageCount");t.updateMessageCount=c;var s=(0,o.createAction)("chat/addPage",(function(){return{payload:(0,r.createPage)()}}));t.addChatPage=s;var l=(0,o.createAction)("chat/changePage");t.changeChatPage=l;var d=(0,o.createAction)("chat/updatePage");t.updateChatPage=d;var u=(0,o.createAction)("chat/toggleAcceptedType");t.toggleAcceptedType=u;var g=(0,o.createAction)("chat/removePage");t.removeChatPage=g;var h=(0,o.createAction)("chat/changeScrollTracking");t.changeScrollTracking=h;var p=(0,o.createAction)("chat/saveToDisk");t.saveChatToDisk=p},44621:function(e,t){"use strict";t.__esModule=!0,t.MESSAGE_TYPES=t.MESSAGE_TYPE_DEBUG=t.MESSAGE_TYPE_ATTACKLOG=t.MESSAGE_TYPE_ADMINLOG=t.MESSAGE_TYPE_EVENTCHAT=t.MESSAGE_TYPE_MODCHAT=t.MESSAGE_TYPE_ADMINCHAT=t.MESSAGE_TYPE_COMBAT=t.MESSAGE_TYPE_ADMINPM=t.MESSAGE_TYPE_OOC=t.MESSAGE_TYPE_DEADCHAT=t.MESSAGE_TYPE_HELPFUL=t.MESSAGE_TYPE_WARNING=t.MESSAGE_TYPE_INFO=t.MESSAGE_TYPE_RADIO=t.MESSAGE_TYPE_LOCALCHAT=t.MESSAGE_TYPE_SYSTEM=t.MESSAGE_TYPE_INTERNAL=t.MESSAGE_TYPE_UNKNOWN=t.IMAGE_RETRY_MESSAGE_AGE=t.IMAGE_RETRY_LIMIT=t.IMAGE_RETRY_DELAY=t.COMBINE_MAX_TIME_WINDOW=t.COMBINE_MAX_MESSAGES=t.MESSAGE_PRUNE_INTERVAL=t.MESSAGE_SAVE_INTERVAL=t.MAX_PERSISTED_MESSAGES=t.MAX_VISIBLE_MESSAGES=void 0;t.MAX_VISIBLE_MESSAGES=2500;t.MAX_PERSISTED_MESSAGES=1e3;t.MESSAGE_SAVE_INTERVAL=1e4;t.MESSAGE_PRUNE_INTERVAL=6e4;t.COMBINE_MAX_MESSAGES=5;t.COMBINE_MAX_TIME_WINDOW=5e3;t.IMAGE_RETRY_DELAY=250;t.IMAGE_RETRY_LIMIT=10;t.IMAGE_RETRY_MESSAGE_AGE=6e4;var n="unknown";t.MESSAGE_TYPE_UNKNOWN=n;t.MESSAGE_TYPE_INTERNAL="internal";var o="system";t.MESSAGE_TYPE_SYSTEM=o;var r="localchat";t.MESSAGE_TYPE_LOCALCHAT=r;var i="radio";t.MESSAGE_TYPE_RADIO=i;var a="info";t.MESSAGE_TYPE_INFO=a;var c="warning";t.MESSAGE_TYPE_WARNING=c;var s="helpful";t.MESSAGE_TYPE_HELPFUL=s;var l="deadchat";t.MESSAGE_TYPE_DEADCHAT=l;t.MESSAGE_TYPE_OOC="ooc";var d="adminpm";t.MESSAGE_TYPE_ADMINPM=d;var u="combat";t.MESSAGE_TYPE_COMBAT=u;var g="adminchat";t.MESSAGE_TYPE_ADMINCHAT=g;var h="modchat";t.MESSAGE_TYPE_MODCHAT=h;t.MESSAGE_TYPE_EVENTCHAT="eventchat";var p="adminlog";t.MESSAGE_TYPE_ADMINLOG=p;var f="attacklog";t.MESSAGE_TYPE_ATTACKLOG=f;var m="debug";t.MESSAGE_TYPE_DEBUG=m;var v=[{type:o,name:"System Messages",description:"Messages from your client, always enabled",selector:".boldannounce",important:!0},{type:r,name:"Local",description:"In-character local messages (say, emote, etc)",selector:".say, .emote, .say_quote, .german, .rough, .japanese, .monkey, .vox, .changeling, .soghun, .tajaran, .xenotalk"},{type:i,name:"Radio",description:"All departments of radio messages",selector:".radio, .xeno, .xenoqueen, .xenoleader, .alert, .newscaster"},{type:a,name:"Info",description:"Non-urgent messages from the game and items",selector:".notice:not(.pm), .adminnotice, .info, .role_body, .role_header, .event_announcement, .announce_header, .announce_header_blue, .announce_body, .sinister, .cult, .xenonotice, .xenoannounce, .yautjabold, .yautjaboldbig"},{type:c,name:"Warnings",description:"Urgent messages from the game and items",selector:".warning:not(.pm), .critical, .userdanger, .italics, .xenowarning, .xenominorwarning"},{type:l,name:"Deadchat",description:"All of deadchat",selector:".deadsay"},{type:"ooc",name:"OOC",description:"The bluewall of global OOC messages",selector:".ooc, .adminooc, .xooc, .mooc, .yooc, .modooc"},{type:d,name:"Admin PMs",description:"Messages to/from admins (adminhelp)",selector:".pm, .adminhelp"},{type:u,name:"Combat Log",description:"Urist McTraitor has stabbed you with a knife!",selector:".danger, .moderate, .disarm, .attack, .passive, .xenodanger, .xenohighdanger, .highdanger, .avoidharm"},{type:s,name:"Helpful",description:"PFC Unga Dunga starts feeding you a pill.",selector:".helpful"},{type:n,name:"Unsorted",description:"Everything we could not sort, always enabled"},{type:g,name:"Admin Chat",description:"ASAY messages",selector:".admin_channel, .adminsay, .headminsay",admin:!0},{type:h,name:"Mod Chat",description:"MSAY messages",selector:".mod_channel, .mod, .adminmod, .mentorsay, .staffsay",admin:!0},{type:p,name:"Admin Log",description:"ADMIN LOG: Urist McAdmin has jumped to coordinates X, Y, Z",selector:".log_message, .admin",admin:!0},{type:f,name:"Attack Log",description:"Urist McTraitor has shot John Doe",selector:".attacklog",admin:!0},{type:m,name:"Debug Log",description:"DEBUG: SSPlanets subsystem Recover().",selector:".debuginfo",admin:!0}];t.MESSAGE_TYPES=v},62225:function(e,t,n){"use strict";t.__esModule=!0,t.chatReducer=t.chatMiddleware=t.ChatTabs=t.ChatPanel=t.ChatPageSettings=void 0;var o=n(56482);t.ChatPageSettings=o.ChatPageSettings;var r=n(83884);t.ChatPanel=r.ChatPanel;var i=n(46688);t.ChatTabs=i.ChatTabs;var a=n(61494);t.chatMiddleware=a.chatMiddleware;var c=n(8715);t.chatReducer=c.chatReducer},61494:function(e,t,n){"use strict";t.__esModule=!0,t.chatMiddleware=void 0;var o,r=(o=n(65054))&&o.__esModule?o:{"default":o},i=n(9034),a=n(19604),c=n(39773),s=n(7041),l=n(44621),d=n(31737),u=n(86474),g=n(95040);function h(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function f(e,t,n,o,r,i,a){try{var c=e[i](a),s=c.value}catch(l){return void n(l)}c.done?t(s):Promise.resolve(s).then(o,r)}function m(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){f(i,o,r,a,c,"next",e)}function c(e){f(i,o,r,a,c,"throw",e)}a(undefined)}))}}var v=["a","iframe","link","video"],S=function(){var e=m(regeneratorRuntime.mark((function t(e){var n,o,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=(0,g.selectChat)(e.getState()),o=Math.max(0,u.chatRenderer.messages.length-l.MAX_PERSISTED_MESSAGES),r=u.chatRenderer.messages.slice(o).map((function(e){return(0,d.serializeMessage)(e)})),i.storage.set("chat-state-cm",n),i.storage.set("chat-messages-cm",r);case 5:case"end":return t.stop()}}),t)})));return function(t){return e.apply(this,arguments)}}(),y=function(){var e=m(regeneratorRuntime.mark((function t(e){var n,o,a,c,l,g,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([i.storage.get("chat-state-cm"),i.storage.get("chat-messages-cm")]);case 2:if(n=t.sent,o=n[0],a=n[1],!(o&&o.version<=4)){t.next=8;break}return e.dispatch((0,s.loadChat)()),t.abrupt("return");case 8:if(a){for(c=h(a);!(l=c()).done;)(g=l.value).html&&(g.html=r["default"].sanitize(g.html,{FORBID_TAGS:v}));p=[].concat(a,[(0,d.createMessage)({type:"internal/reconnected"})]),u.chatRenderer.processBatch(p,{prepend:!0})}e.dispatch((0,s.loadChat)(o));case 10:case"end":return t.stop()}}),t)})));return function(t){return e.apply(this,arguments)}}();t.chatMiddleware=function(e){var t=!1,n=!1;return u.chatRenderer.events.on("batchProcessed",(function(t){n&&e.dispatch((0,s.updateMessageCount)(t))})),u.chatRenderer.events.on("scrollTrackingChanged",(function(t){e.dispatch((0,s.changeScrollTracking)(t))})),setInterval((function(){return S(e)}),l.MESSAGE_SAVE_INTERVAL),function(o){return function(r){var i=r.type,l=r.payload;if(t||(t=!0,y(e)),"chat/message"!==i){if(i===s.loadChat.type){o(r);var d=(0,g.selectCurrentChatPage)(e.getState());return u.chatRenderer.changePage(d),u.chatRenderer.onStateLoaded(),void(n=!0)}if(i!==s.changeChatPage.type&&i!==s.addChatPage.type&&i!==s.removeChatPage.type&&i!==s.toggleAcceptedType.type){if(i===s.rebuildChat.type)return u.chatRenderer.rebuildChat(),o(r);if(i!==a.updateSettings.type&&i!==a.loadSettings.type&&i!==a.addHighlightSetting.type&&i!==a.removeHighlightSetting.type&&i!==a.updateHighlightSetting.type){if("roundrestart"===i)return S(e),o(r);if(i!==s.saveChatToDisk.type)return o(r);u.chatRenderer.saveToDisk()}else{o(r);var h=(0,c.selectSettings)(e.getState());u.chatRenderer.setHighlight(h.highlightSettings,h.highlightSettingById)}}else{o(r);var p=(0,g.selectCurrentChatPage)(e.getState());u.chatRenderer.changePage(p)}}else{var f=Array.isArray(l)?l:[l];u.chatRenderer.processBatch(f)}}}}},31737:function(e,t,n){"use strict";t.__esModule=!0,t.isSameMessage=t.serializeMessage=t.createMessage=t.createMainPage=t.createPage=t.canPageAcceptType=void 0;var o=n(9399),r=n(44621);function i(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}t.canPageAcceptType=function(e,t){return t.startsWith(r.MESSAGE_TYPE_INTERNAL)||e.acceptedTypes[t]};var c=function(e){return Object.assign({id:(0,o.createUuid)(),name:"New Tab",acceptedTypes:{},unreadCount:0,createdAt:Date.now()},e)};t.createPage=c;t.createMainPage=function(){for(var e,t={},n=i(r.MESSAGE_TYPES);!(e=n()).done;){t[e.value.type]=!0}return c({name:"Main",acceptedTypes:t})};t.createMessage=function(e){return Object.assign({createdAt:Date.now()},e)};t.serializeMessage=function(e){return{type:e.type,text:e.text,html:e.html,times:e.times,createdAt:e.createdAt}};t.isSameMessage=function(e,t){return"string"==typeof e.text&&e.text===t.text||"string"==typeof e.html&&e.html===t.html}},8715:function(e,t,n){"use strict";t.__esModule=!0,t.chatReducer=t.initialState=void 0;var o,r=n(7041),i=n(31737);function a(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return c(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var s=(0,i.createMainPage)(),l={version:5,currentPageId:s.id,scrollTracking:!0,pages:[s.id],pageById:(o={},o[s.id]=s,o)};t.initialState=l;t.chatReducer=function(e,t){void 0===e&&(e=l);var n,o=t.type,c=t.payload;if(o===r.loadChat.type){if((null==c?void 0:c.version)!==e.version)return e;for(var d=0,u=Object.keys(c.pageById);d<u.length;d++){var g=u[d];c.pageById[g].unreadCount=0}return Object.assign({},e,c)}if(o===r.changeScrollTracking.type){var h=c,p=Object.assign({},e,{scrollTracking:h});if(h){var f,m=e.currentPageId,v=Object.assign({},e.pageById[m],{unreadCount:0});p.pageById=Object.assign({},e.pageById,((f={})[m]=v,f))}return p}if(o===r.updateMessageCount.type){for(var S,y=c,b=e.pages.map((function(t){return e.pageById[t]})),_=e.pageById[e.currentPageId],C=Object.assign({},e.pageById),E=a(b);!(S=E()).done;){for(var A=S.value,T=0,I=0,M=Object.keys(y);I<M.length;I++){var N=M[I];(0,i.canPageAcceptType)(A,N)&&(A===_&&e.scrollTracking||A!==_&&(0,i.canPageAcceptType)(_,N)||(T+=y[N]))}T>0&&(C[A.id]=Object.assign({},A,{unreadCount:A.unreadCount+T}))}return Object.assign({},e,{pageById:C})}if(o===r.addChatPage.type)return Object.assign({},e,{currentPageId:c.id,pages:[].concat(e.pages,[c.id]),pageById:Object.assign({},e.pageById,(n={},n[c.id]=c,n))});if(o===r.changeChatPage.type){var w,P=c.pageId,k=Object.assign({},e.pageById[P],{unreadCount:0});return Object.assign({},e,{currentPageId:P,pageById:Object.assign({},e.pageById,(w={},w[P]=k,w))})}if(o===r.updateChatPage.type){var x,R=c.pageId,O=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(c,["pageId"]),V=Object.assign({},e.pageById[R],O);return Object.assign({},e,{pageById:Object.assign({},e.pageById,(x={},x[R]=V,x))})}if(o===r.toggleAcceptedType.type){var G,B=c.pageId,L=c.type,j=Object.assign({},e.pageById[B]);return j.acceptedTypes=Object.assign({},j.acceptedTypes),j.acceptedTypes[L]=!j.acceptedTypes[L],Object.assign({},e,{pageById:Object.assign({},e.pageById,(G={},G[B]=j,G))})}if(o===r.removeChatPage.type){var H=c.pageId,D=Object.assign({},e,{pages:[].concat(e.pages),pageById:Object.assign({},e.pageById)});return delete D.pageById[H],D.pages=D.pages.filter((function(e){return e!==H})),0===D.pages.length&&(D.pages.push(s.id),D.pageById[s.id]=s,D.currentPageId=s.id),D.currentPageId&&D.currentPageId!==H||(D.currentPageId=D.pages[0]),D}return e}},86474:function(e,t,n){"use strict";t.__esModule=!0,t.chatRenderer=void 0;var o=n(52318),r=n(34380),i=n(88654),a=n(44621),c=n(31737),s=n(19992);function l(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return d(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return d(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0;return function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function d(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var u=(0,i.createLogger)("chatRenderer"),g=function(e,t){var n=document.createElement("span");return n.className="Chat__highlight",n.setAttribute("style","background-color:"+t),n.textContent=e,n},h=function(){var e=document.createElement("div");return e.className="ChatMessage",e},p=function(){var e=document.createElement("div");return e.className="Chat__reconnected",e},f=function(e){setTimeout((function(){var t=e.target,n=parseInt(t.getAttribute("data-reload-n"),10)||0;if(n>=a.IMAGE_RETRY_LIMIT)u.error("failed to load an image after "+n+" attempts");else{var o=t.src;t.src=null,t.src=o+"#"+n,t.setAttribute("data-reload-n",n+1)}}),a.IMAGE_RETRY_DELAY)},m=function(e){var t=e.node,n=e.times;if(t&&n){var o=t.querySelector(".Chat__badge"),i=o||document.createElement("div");i.textContent=n,i.className=(0,r.classes)(["Chat__badge","Chat__badge--animate"]),requestAnimationFrame((function(){i.className="Chat__badge"})),o||t.appendChild(i)}},v=function(){function e(){var e=this;this.loaded=!1,this.rootNode=null,this.queue=[],this.messages=[],this.visibleMessages=[],this.page=null,this.events=new o.EventEmitter,this.scrollNode=null,this.scrollTracking=!0,this.handleScroll=function(t){var n=e.scrollNode,o=n.scrollHeight,r=n.scrollTop+n.offsetHeight,i=Math.abs(o-r)<24;i!==e.scrollTracking&&(e.scrollTracking=i,e.events.emit("scrollTrackingChanged",i),u.debug("tracking",e.scrollTracking))},this.ensureScrollTracking=function(){e.scrollTracking&&e.scrollToBottom()},setInterval((function(){return e.pruneMessages()}),a.MESSAGE_PRUNE_INTERVAL)}var t=e.prototype;return t.isReady=function(){return this.loaded&&this.rootNode&&this.page},t.mount=function(e){var t=this;this.rootNode?e.appendChild(this.rootNode):this.rootNode=e,this.scrollNode=function(e){for(var t=document.body,n=e;n&&n!==t;){if(n.scrollWidth<n.offsetWidth)return n;n=n.parentNode}return window}(this.rootNode),this.scrollNode.addEventListener("scroll",this.handleScroll),setImmediate((function(){t.scrollToBottom()})),this.tryFlushQueue()},t.onStateLoaded=function(){this.loaded=!0,this.tryFlushQueue()},t.tryFlushQueue=function(){this.isReady()&&this.queue.length>0&&(this.processBatch(this.queue),this.queue=[])},t.assignStyle=function(e){void 0===e&&(e={});for(var t=0,n=Object.keys(e);t<n.length;t++){var o=n[t];this.rootNode.style.setProperty(o,e[o])}},t.setHighlight=function(e,t){var n=this;this.highlightParsers=null,e&&e.map((function(e){var o,r,i=t[e],a=i.highlightText,c=i.highlightColor,s=i.highlightWholeMessage,d=/^[a-z0-9_\-$/^[\s\]\\]+$/gi,u=String(a).split(",").map((function(e){return e.trim()})).filter((function(e){return e&&e.length>1&&d.test(e)&&((d.lastIndex=0)||!0)}));if(0!==u.length){for(var g,h=[],p=l(u);!(g=p()).done;){var f=g.value;if("/"===f.charAt(0)&&"/"===f.charAt(f.length-1)){var m=f.substring(1,f.length-1);if(/^(\[.*\]|\\.|.)$/.test(m))continue;h.push(m)}else o||(o=[]),o.push(f)}var v=h.join("|");v&&(r=new RegExp("("+v+")","gi")),n.highlightParsers||(n.highlightParsers=[]),n.highlightParsers.push({highlightWords:o,highlightRegex:r,highlightColor:c,highlightWholeMessage:s})}}))},t.scrollToBottom=function(){this.scrollNode.scrollTop=this.scrollNode.scrollHeight},t.changePage=function(e){if(!this.isReady())return this.page=e,void this.tryFlushQueue();this.page=e,this.rootNode.textContent="",this.visibleMessages=[];for(var t,n,o=document.createDocumentFragment(),r=l(this.messages);!(n=r()).done;){var i=n.value;(0,c.canPageAcceptType)(e,i.type)&&(t=i.node,o.appendChild(t),this.visibleMessages.push(i))}t&&(this.rootNode.appendChild(o),t.scrollIntoView())},t.getCombinableMessage=function(e){for(var t=Date.now(),n=this.visibleMessages.length,o=n-1,r=Math.max(0,n-a.COMBINE_MAX_MESSAGES),i=o;i>=r;i--){var s=this.visibleMessages[i];if(!s.type.startsWith(a.MESSAGE_TYPE_INTERNAL)&&(0,c.isSameMessage)(s,e)&&t<s.createdAt+a.COMBINE_MAX_TIME_WINDOW)return s}return null},t.processBatch=function(e,t){var n=this;void 0===t&&(t={});var o=t,r=o.prepend,i=o.notifyListeners,d=void 0===i||i,v=Date.now();if(this.isReady()){for(var S,y,b=document.createDocumentFragment(),_={},C=l(e);!(y=C()).done;){var E=y.value,A=(0,c.createMessage)(E),T=this.getCombinableMessage(A);if(T)T.times=(T.times||1)+1,m(T);else{if(A.node)S=A.node;else if("internal/reconnected"===A.type)S=p();else{S=h(),A.text?S.textContent=A.text:A.html?S.innerHTML=A.html:u.error("Error: message is missing text payload",A),!A.avoidHighlighting&&this.highlightParsers&&this.highlightParsers.map((function(e){(0,s.highlightNode)(S,e.highlightRegex,e.highlightWords,(function(t){return g(t,e.highlightColor)}))&&e.highlightWholeMessage&&(S.className+=" ChatMessage--highlighted")}));for(var I=S.querySelectorAll(".linkify"),M=0;M<I.length;++M)(0,s.linkifyNode)(I[M]);if(v<A.createdAt+a.IMAGE_RETRY_MESSAGE_AGE)for(var N=S.querySelectorAll("img"),w=0;w<N.length;w++)N[w].addEventListener("error",f)}if(A.node=S,!A.type){var P=!Byond.IS_LTE_IE8&&a.MESSAGE_TYPES.find((function(e){return e.selector&&S.querySelector(e.selector)}));A.type=(null==P?void 0:P.type)||a.MESSAGE_TYPE_UNKNOWN}m(A),_[A.type]||(_[A.type]=0),_[A.type]+=1,this.messages.push(A),(0,c.canPageAcceptType)(this.page,A.type)&&(b.appendChild(S),this.visibleMessages.push(A))}}if(S){var k=this.rootNode.childNodes[0];r&&k?this.rootNode.insertBefore(b,k):this.rootNode.appendChild(b),this.scrollTracking&&setImmediate((function(){return n.scrollToBottom()}))}d&&this.events.emit("batchProcessed",_)}else this.queue=r?[].concat(e,this.queue):[].concat(this.queue,e)},t.pruneMessages=function(){if(this.isReady())if(this.scrollTracking){var e=this.visibleMessages,t=Math.max(0,e.length-a.MAX_VISIBLE_MESSAGES);if(t>0){this.visibleMessages=e.slice(t);for(var n=0;n<t;n++){var o=e[n];this.rootNode.removeChild(o.node),o.node="pruned"}this.messages=this.messages.filter((function(e){return"pruned"!==e.node})),u.log("pruned "+t+" visible messages")}var r=Math.max(0,this.messages.length-a.MAX_PERSISTED_MESSAGES);r>0&&(this.messages=this.messages.slice(r),u.log("pruned "+r+" stored messages"))}else u.debug("pruning delayed")},t.rebuildChat=function(){if(this.isReady()){for(var e,t=Math.max(0,this.messages.length-a.MAX_PERSISTED_MESSAGES),n=this.messages.slice(t),o=l(n);!(e=o()).done;)e.value.node=undefined;this.rootNode.textContent="",this.messages=[],this.visibleMessages=[],this.processBatch(n,{notifyListeners:!1})}},t.saveToDisk=function(){if(!Byond.IS_LTE_IE10){for(var e="",t=document.styleSheets,n=0;n<t.length;n++)for(var o=t[n].cssRules,r=0;r<o.length;r++)e+=o[r].cssText+"\n";e+="body, html { background-color: #141414 }\n";for(var i,a="",c=l(this.visibleMessages);!(i=c()).done;){var s=i.value;s.node&&(a+=s.node.outerHTML+"\n")}var d=new Blob(["<!doctype html>\n<html>\n<head>\n<title>SS13 Chat Log</title>\n<style>\n"+e+'</style>\n</head>\n<body>\n<div class="Chat">\n'+a+"</div>\n</body>\n</html>\n"]),u=(new Date).toISOString().substring(0,19).replace(/[-:]/g,"").replace("T","-");window.navigator.msSaveBlob(d,"ss13-chatlog-"+u+".html")}},e}();window.__chatRenderer__||(window.__chatRenderer__=new v);var S=window.__chatRenderer__;t.chatRenderer=S},19992:function(e,t){"use strict";function n(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return o(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}t.__esModule=!0,t.linkifyNode=t.highlightNode=t.replaceInTextNode=void 0;var r=function(e){for(var t,n,o,r,i=e.node,a=e.regex,c=e.createNode,s=e.captureAdjust,l=i.textContent,d=l.length,u=0,g=0,h=0;o=a.exec(l);){if(g+=1,++h>9999)return{};r||(r=document.createDocumentFragment()),t||(t=[]);var p=s?s(o[0]):o[0],f=p.length,m=o.index+o[0].indexOf(p);u<m&&(n=document.createTextNode(l.substring(u,m)),t.push(n),r.appendChild(n)),u=m+f,n=c(p),t.push(n),r.appendChild(n)}return r&&(u<d&&(n=document.createTextNode(l.substring(u,d)),t.push(n),r.appendChild(n)),i.parentNode.replaceChild(r,i)),{nodes:t,n:g}},i=function(e,t,o){return function(i){var a,c,s=0;if(e&&(a=(c=r({node:i,regex:e,createNode:o})).nodes,s+=c.n),t){for(var l,d=0,u="(",g=n(t);!(l=g()).done;){var h=l.value;u+="^"+h+"\\W|\\W"+h+"\\W|\\W"+h+"$|^"+h+"$",++d!==t.length&&(u+="|")}u+=")";var p=new RegExp(u,"gi");if(e&&a)for(var f,m=n(a);!(f=m()).done;){var v=f.value;s+=(c=r({node:v,regex:p,createNode:o,captureAdjust:function(e){return e.replace(/^\W|\W$/g,"")}})).n}else s+=(c=r({node:i,regex:p,createNode:o,captureAdjust:function(e){return e.replace(/^\W|\W$/g,"")}})).n}return s}};t.replaceInTextNode=i;var a=function(e){var t=document.createElement("span");return t.setAttribute("style","background-color:#fd4;color:#000"),t.textContent=e,t};t.highlightNode=function s(e,t,n,o){void 0===o&&(o=a),o||(o=a);for(var r=0,c=e.childNodes,l=0;l<c.length;l++){var d=c[l];3===d.nodeType?r+=i(t,n,o)(d):r+=s(d,t,n,o)}return r};t.linkifyNode=function l(e){for(var t=0,n=e.childNodes,o=0;o<n.length;o++){var r=n[o],i=String(r.nodeName).toLowerCase();3===r.nodeType?t+=c(r):"a"!==i&&(t+=l(r))}return t};var c=i(/(?:(?:https?:\/\/)|(?:www\.))(?:[^ ]*?\.[^ ]*?)+[-A-Za-z0-9+&@#/%?=~_|$!:,.;()]+/gi,null,(function(e){var t=document.createElement("a");return t.href=e,t.textContent=e,t}))},95040:function(e,t,n){"use strict";t.__esModule=!0,t.selectChatPageById=t.selectCurrentChatPage=t.selectChatPages=t.selectChat=void 0;var o=n(35827);t.selectChat=function(e){return e.chat};t.selectChatPages=function(e){return(0,o.map)((function(t){return e.chat.pageById[t]}))(e.chat.pages)};t.selectCurrentChatPage=function(e){return e.chat.pageById[e.chat.currentPageId]};t.selectChatPageById=function(e){return function(t){return t.chat.pageById[e]}}},10589:function(e,t,n){"use strict";t.__esModule=!0,t.connectionRestored=t.connectionLost=t.roundRestarted=void 0;var o=n(25526),r=(0,o.createAction)("roundrestart");t.roundRestarted=r;var i=(0,o.createAction)("game/connectionLost");t.connectionLost=i;var a=(0,o.createAction)("game/connectionRestored");t.connectionRestored=a},39269:function(e,t){"use strict";t.__esModule=!0,t.CONNECTION_LOST_AFTER=void 0;t.CONNECTION_LOST_AFTER=15e3},14609:function(e,t,n){"use strict";t.__esModule=!0,t.useGame=void 0;var o=n(25526),r=n(62125);t.useGame=function(e){return(0,o.useSelector)(e,r.selectGame)}},64398:function(e,t,n){"use strict";t.__esModule=!0,t.gameReducer=t.gameMiddleware=t.useGame=void 0;var o=n(14609);t.useGame=o.useGame;var r=n(26646);t.gameMiddleware=r.gameMiddleware;var i=n(94789);t.gameReducer=i.gameReducer},26646:function(e,t,n){"use strict";t.__esModule=!0,t.gameMiddleware=void 0;var o=n(70530),r=n(10589),i=n(62125),a=n(39269),c=function(e){return Object.assign({},e,{meta:Object.assign({},e.meta,{now:Date.now()})})};t.gameMiddleware=function(e){var t;return setInterval((function(){var n=e.getState();if(n){var o=(0,i.selectGame)(n),s=t&&Date.now()>=t+a.CONNECTION_LOST_AFTER;!o.connectionLostAt&&s&&e.dispatch(c((0,r.connectionLost)())),o.connectionLostAt&&!s&&e.dispatch(c((0,r.connectionRestored)()))}}),1e3),function(e){return function(n){var i=n.type,a=(n.payload,n.meta);return i===o.pingSuccess.type?(t=a.now,e(n)):i===r.roundRestarted.type?e(c(n)):e(n)}}}},94789:function(e,t,n){"use strict";t.__esModule=!0,t.gameReducer=void 0;var o=n(10589),r={roundId:null,roundTime:null,roundRestartedAt:null,connectionLostAt:null};t.gameReducer=function(e,t){void 0===e&&(e=r);var n=t.type,i=(t.payload,t.meta);return"roundrestart"===n?Object.assign({},e,{roundRestartedAt:i.now}):n===o.connectionLost.type?Object.assign({},e,{connectionLostAt:i.now}):n===o.connectionRestored.type?Object.assign({},e,{connectionLostAt:null}):e}},62125:function(e,t){"use strict";t.__esModule=!0,t.selectGame=void 0;t.selectGame=function(e){return e.game}},14808:function(e,t,n){"use strict";var o=n(39812);n(39796),n(12415);var r,i,a=n(84877),c=n(25526),s=(n(25059),n(74360)),l=n(25697),d=n(75682),u=n(69913),g=n(34058),h=n(62225),p=n(64398),f=n(55631),m=n(77965),v=n(67206),S=n(85946);a.perf.mark("inception",null==(r=window.performance)||null==(i=r.timing)?void 0:i.navigationStart),a.perf.mark("init");var y=(0,u.configureStore)({reducer:(0,c.combineReducers)({audio:g.audioReducer,chat:h.chatReducer,game:p.gameReducer,ping:m.pingReducer,settings:v.settingsReducer}),middleware:{pre:[h.chatMiddleware,m.pingMiddleware,S.telemetryMiddleware,v.settingsMiddleware,g.audioMiddleware,p.gameMiddleware]}}),b=(0,d.createRenderer)((function(){var e=n(33154).Panel;return(0,o.createComponentVNode)(2,u.StoreProvider,{store:y,children:(0,o.createComponentVNode)(2,e)})}));!function _(){if("loading"!==document.readyState){for((0,s.setupGlobalEvents)({ignoreWindowFocus:!0}),(0,f.setupPanelFocusHacks)(),(0,l.captureExternalLinks)(),y.subscribe(b),window.update=function(e){return y.dispatch(Byond.parseJson(e))};;){var e=window.__updateQueue__.shift();if(!e)break;window.update(e)}Byond.winset("output",{"is-visible":!1}),Byond.winset("browseroutput",{"is-visible":!0,"is-disabled":!1,pos:"0x0",size:"0x0"}),Byond.winget("output").then((function(e){Byond.winset("browseroutput",{size:e.size})}))}else document.addEventListener("DOMContentLoaded",_)}()},55631:function(e,t,n){"use strict";t.__esModule=!0,t.setupPanelFocusHacks=void 0;var o=n(51961),r=n(74360),i=n(46609),a=function(){return setImmediate((function(){return(0,i.focusMap)()}))};t.setupPanelFocusHacks=function(){var e=!1,t=null;window.addEventListener("focusin",(function(t){e=(0,r.canStealFocus)(t.target)})),window.addEventListener("mousedown",(function(e){t=[e.screenX,e.screenY]})),window.addEventListener("mouseup",(function(n){if(t){var r=[n.screenX,n.screenY];(0,o.vecLength)((0,o.vecSubtract)(r,t))>=10&&(e=!0)}e||a()})),r.globalEvents.on("keydown",(function(e){e.isModifierKey()||a()}))}},4929:function(e,t,n){"use strict";t.__esModule=!0,t.PingIndicator=void 0;var o=n(39812),r=n(8397),i=n(94187),a=n(25526),c=n(74814),s=n(98705);t.PingIndicator=function(e,t){var n=(0,a.useSelector)(t,s.selectPing),l=r.Color.lookup(n.networkQuality,[new r.Color(220,40,40),new r.Color(220,200,40),new r.Color(60,220,40)]),d=n.roundtrip?(0,i.toFixed)(n.roundtrip):"--";return(0,o.createVNode)(1,"div","Ping",[(0,o.createComponentVNode)(2,c.Box,{className:"Ping__indicator",backgroundColor:l}),d],0)}},70530:function(e,t,n){"use strict";t.__esModule=!0,t.pingReply=t.pingFail=t.pingSuccess=void 0;var o=n(25526),r=(0,o.createAction)("ping/success",(function(e){var t=Date.now(),n=.5*(t-e.sentAt);return{payload:{lastId:e.id,roundtrip:n},meta:{now:t}}}));t.pingSuccess=r;var i=(0,o.createAction)("ping/fail");t.pingFail=i;var a=(0,o.createAction)("ping/reply");t.pingReply=a},1658:function(e,t){"use strict";t.__esModule=!0,t.PING_ROUNDTRIP_WORST=t.PING_ROUNDTRIP_BEST=t.PING_QUEUE_SIZE=t.PING_MAX_FAILS=t.PING_TIMEOUT=t.PING_INTERVAL=void 0;t.PING_INTERVAL=2500;t.PING_TIMEOUT=2e3;t.PING_MAX_FAILS=3;t.PING_QUEUE_SIZE=8;t.PING_ROUNDTRIP_BEST=50;t.PING_ROUNDTRIP_WORST=200},77965:function(e,t,n){"use strict";t.__esModule=!0,t.pingReducer=t.PingIndicator=t.pingMiddleware=void 0;var o=n(50794);t.pingMiddleware=o.pingMiddleware;var r=n(4929);t.PingIndicator=r.PingIndicator;var i=n(78667);t.pingReducer=i.pingReducer},50794:function(e,t,n){"use strict";t.__esModule=!0,t.pingMiddleware=void 0;var o=n(71494),r=n(70530),i=n(1658);t.pingMiddleware=function(e){var t,n=!1,a=0,c=[],s=function(){for(var t=0;t<i.PING_QUEUE_SIZE;t++){var n=c[t];n&&Date.now()-n.sentAt>i.PING_TIMEOUT&&(c[t]=null,e.dispatch((0,r.pingFail)()))}var s={index:a,sentAt:Date.now()};c[a]=s,(0,o.sendMessage)({type:"ping",payload:{index:a}}),a=(a+1)%i.PING_QUEUE_SIZE};return function(e){return function(o){var a=o.type,l=o.payload;if(n||(n=!0,t=setInterval(s,i.PING_INTERVAL),s()),"roundrestart"===a)return clearInterval(t),e(o);if("pingReply"===a){var d=l.index,u=c[d];if(!u)return;return c[d]=null,e((0,r.pingSuccess)(u))}return e(o)}}}},78667:function(e,t,n){"use strict";t.__esModule=!0,t.pingReducer=void 0;var o=n(94187),r=n(70530),i=n(1658);t.pingReducer=function(e,t){void 0===e&&(e={});var n=t.type,a=t.payload;if(n===r.pingSuccess.type){var c=a.roundtrip,s=e.roundtripAvg||c,l=Math.round(.4*s+.6*c);return{roundtrip:c,roundtripAvg:l,failCount:0,networkQuality:1-(0,o.scale)(l,i.PING_ROUNDTRIP_BEST,i.PING_ROUNDTRIP_WORST)}}if(n===r.pingFail.type){var d=e.failCount,u=void 0===d?0:d,g=(0,o.clamp01)(e.networkQuality-u/i.PING_MAX_FAILS),h=Object.assign({},e,{failCount:u+1,networkQuality:g});return u>i.PING_MAX_FAILS&&(h.roundtrip=undefined,h.roundtripAvg=undefined),h}return e}},98705:function(e,t){"use strict";t.__esModule=!0,t.selectPing=void 0;t.selectPing=function(e){return e.ping}},88388:function(e,t,n){"use strict";t.__esModule=!0,t.SettingsGeneral=t.SettingsPanel=void 0;var o=n(39812),r=n(94187),i=n(71494),a=n(25526),c=n(74814),s=n(62225),l=n(7041),d=n(40108),u=n(19604),g=n(56289),h=n(39773);t.SettingsPanel=function(e,t){var n=(0,a.useSelector)(t,h.selectActiveTab),r=(0,a.useDispatch)(t);return(0,o.createComponentVNode)(2,c.Stack,{fill:!0,children:[(0,o.createComponentVNode)(2,c.Stack.Item,{children:(0,o.createComponentVNode)(2,c.Section,{fitted:!0,fill:!0,minHeight:"8em",children:(0,o.createComponentVNode)(2,c.Tabs,{vertical:!0,children:g.SETTINGS_TABS.map((function(e){return(0,o.createComponentVNode)(2,c.Tabs.Tab,{selected:e.id===n,onClick:function(){return r((0,u.changeSettingsTab)({tabId:e.id}))},children:e.name},e.id)}))})})}),(0,o.createComponentVNode)(2,c.Stack.Item,{grow:1,basis:0,children:["general"===n&&(0,o.createComponentVNode)(2,p),"textHighlight"===n&&(0,o.createComponentVNode)(2,f),"chatPage"===n&&(0,o.createComponentVNode)(2,s.ChatPageSettings)]})]})};var p=function(e,t){var n=(0,a.useSelector)(t,h.selectSettings),s=n.theme,p=n.fontFamily,f=n.fontSize,m=n.lineHeight,v=(0,a.useDispatch)(t),S=(0,i.useLocalState)(t,"freeFont",!1),y=S[0],b=S[1];return(0,o.createComponentVNode)(2,c.Section,{children:[(0,o.createComponentVNode)(2,c.LabeledList,{children:[(0,o.createComponentVNode)(2,c.LabeledList.Item,{label:"Theme",children:(0,o.createComponentVNode)(2,c.Dropdown,{selected:s,options:d.THEMES,onSelected:function(e){return v((0,u.updateSettings)({theme:e}))}})}),(0,o.createComponentVNode)(2,c.LabeledList.Item,{label:"Font style",children:(0,o.createComponentVNode)(2,c.Stack,{inline:!0,align:"baseline",children:[(0,o.createComponentVNode)(2,c.Stack.Item,{children:!y&&(0,o.createComponentVNode)(2,c.Dropdown,{selected:p,options:g.FONTS,onSelected:function(e){return v((0,u.updateSettings)({fontFamily:e}))}})||(0,o.createComponentVNode)(2,c.Input,{value:p,onChange:function(e,t){return v((0,u.updateSettings)({fontFamily:t}))}})}),(0,o.createComponentVNode)(2,c.Stack.Item,{children:(0,o.createComponentVNode)(2,c.Button,{content:"Custom font",icon:y?"lock-open":"lock",color:y?"good":"bad",ml:1,onClick:function(){b(!y)}})})]})}),(0,o.createComponentVNode)(2,c.LabeledList.Item,{label:"Font size",children:(0,o.createComponentVNode)(2,c.NumberInput,{width:"4em",step:1,stepPixelSize:10,minValue:8,maxValue:32,value:f,unit:"px",format:function(e){return(0,r.toFixed)(e)},onChange:function(e,t){return v((0,u.updateSettings)({fontSize:t}))}})}),(0,o.createComponentVNode)(2,c.LabeledList.Item,{label:"Line height",children:(0,o.createComponentVNode)(2,c.NumberInput,{width:"4em",step:.01,stepPixelSize:2,minValue:.8,maxValue:5,value:m,format:function(e){return(0,r.toFixed)(e,2)},onDrag:function(e,t){return v((0,u.updateSettings)({lineHeight:t}))}})})]}),(0,o.createComponentVNode)(2,c.Divider),(0,o.createComponentVNode)(2,c.Button,{icon:"save",onClick:function(){return v((0,l.saveChatToDisk)())},children:"Save chat log"})]})};t.SettingsGeneral=p;var f=function(e,t){var n=(0,a.useSelector)(t,h.selectHighlightSettings),r=(0,a.useDispatch)(t);return(0,o.createComponentVNode)(2,c.Section,{fill:!0,height:"190px",children:[(0,o.createComponentVNode)(2,c.Section,{fill:!0,scrollable:!0,maxHeight:"150px",children:(0,o.createComponentVNode)(2,c.Stack,{vertical:!0,children:[n.map((function(e,t){return(0,o.createComponentVNode)(2,m,{id:e,mb:t+1===n.length?0:"10px"},t)})),n.length<g.MAX_HIGHLIGHT_SETTINGS&&(0,o.createComponentVNode)(2,c.Stack.Item,{children:(0,o.createComponentVNode)(2,c.Button,{color:"transparent",icon:"plus",content:"Add Highlight Setting",onClick:function(){r((0,u.addHighlightSetting)())}})})]})}),(0,o.createComponentVNode)(2,c.Box,{children:[(0,o.createComponentVNode)(2,c.Button,{icon:"check",onClick:function(){return r((0,l.rebuildChat)())},children:"Apply now"}),(0,o.createComponentVNode)(2,c.Box,{inline:!0,fontSize:"0.9em",ml:1,color:"label",children:"Can freeze the chat for a while."})]})]})},m=function(e,t){var n=e.id,r=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,["id"]),i=(0,a.useSelector)(t,h.selectHighlightSettingById),s=(0,a.useDispatch)(t),l=i[n],d=l.highlightColor,g=l.highlightText,p=l.highlightWholeMessage;return(0,o.normalizeProps)((0,o.createComponentVNode)(2,c.Stack.Item,Object.assign({},r,{children:[(0,o.createComponentVNode)(2,c.Flex,{color:"label",align:"baseline",children:[(0,o.createComponentVNode)(2,c.Flex.Item,{grow:1,children:(0,o.createComponentVNode)(2,c.Button,{content:"Highlight words (comma separated):",color:"transparent",icon:"times",onClick:function(){return s((0,u.removeHighlightSetting)({id:n}))}})}),(0,o.createComponentVNode)(2,c.Flex.Item,{shrink:0,children:(0,o.createComponentVNode)(2,c.Button.Checkbox,{checked:p,content:"Highlight Whole Message",mr:"5px",onClick:function(){return s((0,u.updateHighlightSetting)({id:n,highlightWholeMessage:!p}))}})}),(0,o.createComponentVNode)(2,c.Flex.Item,{shrink:0,children:[(0,o.createComponentVNode)(2,c.ColorBox,{mr:1,color:d}),(0,o.createComponentVNode)(2,c.Input,{width:"5em",monospace:!0,placeholder:"#ffffff",value:d,onInput:function(e,t){return s((0,u.updateHighlightSetting)({id:n,highlightColor:t}))}})]})]}),(0,o.createComponentVNode)(2,c.TextArea,{height:"3em",value:g,onChange:function(e,t){return s((0,u.updateHighlightSetting)({id:n,highlightText:t}))}})]})))}},19604:function(e,t,n){"use strict";t.__esModule=!0,t.updateHighlightSetting=t.removeHighlightSetting=t.addHighlightSetting=t.openChatSettings=t.toggleSettings=t.changeSettingsTab=t.loadSettings=t.updateSettings=void 0;var o=n(25526),r=n(34633),i=(0,o.createAction)("settings/update");t.updateSettings=i;var a=(0,o.createAction)("settings/load");t.loadSettings=a;var c=(0,o.createAction)("settings/changeTab");t.changeSettingsTab=c;var s=(0,o.createAction)("settings/toggle");t.toggleSettings=s;var l=(0,o.createAction)("settings/openChatTab");t.openChatSettings=l;var d=(0,o.createAction)("settings/addHighlightSetting",(function(){return{payload:(0,r.createHighlightSetting)()}}));t.addHighlightSetting=d;var u=(0,o.createAction)("settings/removeHighlightSetting");t.removeHighlightSetting=u;var g=(0,o.createAction)("settings/updateHighlightSetting");t.updateHighlightSetting=g},56289:function(e,t){"use strict";t.__esModule=!0,t.MAX_HIGHLIGHT_SETTINGS=t.FONTS=t.FONTS_DISABLED=t.SETTINGS_TABS=void 0;t.SETTINGS_TABS=[{id:"general",name:"General"},{id:"textHighlight",name:"Text Highlights"},{id:"chatPage",name:"Chat Tabs"}];var n="Default";t.FONTS_DISABLED=n;var o=[n,"Verdana","Arial","Arial Black","Comic Sans MS","Impact","Lucida Sans Unicode","Tahoma","Trebuchet MS","Courier New","Lucida Console"];t.FONTS=o;t.MAX_HIGHLIGHT_SETTINGS=10},22180:function(e,t,n){"use strict";t.__esModule=!0,t.useSettings=void 0;var o=n(25526),r=n(19604),i=n(39773);t.useSettings=function(e){var t=(0,o.useSelector)(e,i.selectSettings),n=(0,o.useDispatch)(e);return Object.assign({},t,{visible:t.view.visible,toggle:function(){return n((0,r.toggleSettings)())},update:function(e){return n((0,r.updateSettings)(e))}})}},67206:function(e,t,n){"use strict";t.__esModule=!0,t.SettingsPanel=t.settingsReducer=t.settingsMiddleware=t.useSettings=void 0;var o=n(22180);t.useSettings=o.useSettings;var r=n(85542);t.settingsMiddleware=r.settingsMiddleware;var i=n(83376);t.settingsReducer=i.settingsReducer;var a=n(88388);t.SettingsPanel=a.SettingsPanel},85542:function(e,t,n){"use strict";t.__esModule=!0,t.settingsMiddleware=void 0;var o=n(9034),r=n(40108),i=n(19604),a=n(39773),c=n(56289);t.settingsMiddleware=function(e){var t=!1;return function(n){return function(s){var l,d,u=s.type,g=s.payload;if(t||(t=!0,o.storage.get("panel-settings").then((function(t){e.dispatch((0,i.loadSettings)(t))}))),u===i.updateSettings.type||u===i.loadSettings.type||u===i.addHighlightSetting.type||u===i.removeHighlightSetting.type||u===i.updateHighlightSetting.type){var h=null==g?void 0:g.theme;h&&(0,r.setClientTheme)(h),n(s);var p=(0,a.selectSettings)(e.getState());return d=p.fontSize,document.documentElement.style.setProperty("font-size",d+"px"),document.body.style.setProperty("font-size",d+"px"),(l=p.fontFamily)===c.FONTS_DISABLED&&(l=null),document.documentElement.style.setProperty("font-family",l),document.body.style.setProperty("font-family",l),void o.storage.set("panel-settings",p)}return n(s)}}}},34633:function(e,t,n){"use strict";t.__esModule=!0,t.createDefaultHighlightSetting=t.createHighlightSetting=void 0;var o=n(9399),r=function(e){return Object.assign({id:(0,o.createUuid)(),highlightText:"",highlightColor:"#ffdd44",highlightWholeMessage:!0},e)};t.createHighlightSetting=r;t.createDefaultHighlightSetting=function(e){return r(Object.assign({id:"default"},e))}},83376:function(e,t,n){"use strict";t.__esModule=!0,t.settingsReducer=void 0;var o,r=n(19604),i=n(34633),a=n(56289);var c=(0,i.createDefaultHighlightSetting)(),s={version:1,fontSize:13,fontFamily:a.FONTS[0],lineHeight:1.2,theme:"light",adminMusicVolume:.5,highlightText:"",highlightColor:"#ffdd44",highlightSettings:[c.id],highlightSettingById:(o={},o[c.id]=c,o),view:{visible:!1,activeTab:a.SETTINGS_TABS[0].id}};t.settingsReducer=function(e,t){void 0===e&&(e=s);var n=t.type,o=t.payload;if(n===r.updateSettings.type)return Object.assign({},e,o);if(n===r.loadSettings.type){if(null==o||!o.version)return e;delete o.view;var i=Object.assign({},e,o);i.highlightSettings?i.highlightSettingById[c.id]||(i.highlightSettings=[c.id].concat(i.highlightSettings),i.highlightSettingById[c.id]=c):(i.highlightSettings=[c.id],i.highlightSettingById[c.id]=c);var l=i.highlightSettingById[c.id];return l.highlightColor=i.highlightColor,l.highlightText=i.highlightText,i}if(n===r.toggleSettings.type)return Object.assign({},e,{view:Object.assign({},e.view,{visible:!e.view.visible})});if(n===r.openChatSettings.type)return Object.assign({},e,{view:Object.assign({},e.view,{visible:!0,activeTab:"chatPage"})});if(n===r.changeSettingsTab.type){var d=o.tabId;return Object.assign({},e,{view:Object.assign({},e.view,{activeTab:d})})}if(n===r.addHighlightSetting.type){var u,g=o;return e.highlightSettings.length>=a.MAX_HIGHLIGHT_SETTINGS?e:Object.assign({},e,{highlightSettings:[].concat(e.highlightSettings,[g.id]),highlightSettingById:Object.assign({},e.highlightSettingById,(u={},u[g.id]=g,u))})}if(n===r.removeHighlightSetting.type){var h=o.id,p=Object.assign({},e,{highlightSettings:[].concat(e.highlightSettings),highlightSettingById:Object.assign({},e.highlightSettingById)});return h===c.id?p.highlightSettings[c.id]=c:(delete p.highlightSettingById[h],p.highlightSettings=p.highlightSettings.filter((function(e){return e!==h})),p.highlightSettings.length||(p.highlightSettings.push(c.id),p.highlightSettingById[c.id]=c)),p}if(n===r.updateHighlightSetting.type){var f=o.id,m=function(e,t){if(null==e)return{};var n,o,r={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(o,["id"]),v=Object.assign({},e,{highlightSettings:[].concat(e.highlightSettings),highlightSettingById:Object.assign({},e.highlightSettingById)});return f===c.id&&(m.highlightText&&(v.highlightText=m.highlightText),m.highlightColor&&(v.highlightColor=m.highlightColor)),v.highlightSettingById[f]&&(v.highlightSettingById[f]=Object.assign({},v.highlightSettingById[f],m)),v}return e}},39773:function(e,t){"use strict";t.__esModule=!0,t.selectHighlightSettingById=t.selectHighlightSettings=t.selectActiveTab=t.selectSettings=void 0;t.selectSettings=function(e){return e.settings};t.selectActiveTab=function(e){return e.settings.view.activeTab};t.selectHighlightSettings=function(e){return e.settings.highlightSettings};t.selectHighlightSettingById=function(e){return e.settings.highlightSettingById}},85946:function(e,t,n){"use strict";t.__esModule=!0,t.telemetryMiddleware=void 0;var o=n(71494),r=n(9034);function i(e,t,n,o,r,i,a){try{var c=e[i](a),s=c.value}catch(l){return void n(l)}c.done?t(s):Promise.resolve(s).then(o,r)}var a=(0,n(88654).createLogger)("telemetry");t.telemetryMiddleware=function(e){var t,n;return function(c){return function(s){var l,d=s.type,u=s.payload;if("telemetry/request"!==d)return"backend/update"===d?(c(s),void(l=regeneratorRuntime.mark((function p(){var o,i,c,s;return regeneratorRuntime.wrap((function(l){for(;;)switch(l.prev=l.next){case 0:if(i=null==u||null==(o=u.config)?void 0:o.client){l.next=4;break}return a.error("backend/update payload is missing client data!"),l.abrupt("return");case 4:if(t){l.next=13;break}return l.next=7,r.storage.get("telemetry");case 7:if(l.t0=l.sent,l.t0){l.next=10;break}l.t0={};case 10:(t=l.t0).connections||(t.connections=[]),a.debug("retrieved telemetry from storage",t);case 13:c=!1,t.connections.find((function(e){return n=i,(t=e).ckey===n.ckey&&t.address===n.address&&t.computer_id===n.computer_id;var t,n}))||(c=!0,t.connections.unshift(i),t.connections.length>10&&t.connections.pop()),c&&(a.debug("saving telemetry to storage",t),r.storage.set("telemetry",t)),n&&(s=n,n=null,e.dispatch({type:"telemetry/request",payload:s}));case 18:case"end":return l.stop()}}),p)})),function(){var e=this,t=arguments;return new Promise((function(n,o){var r=l.apply(e,t);function a(e){i(r,n,o,a,c,"next",e)}function c(e){i(r,n,o,a,c,"throw",e)}a(undefined)}))})()):c(s);if(!t)return a.debug("deferred"),void(n=u);a.debug("sending");var g=(null==u?void 0:u.limits)||{},h=t.connections.slice(0,g.connections);(0,o.sendMessage)({type:"telemetry",payload:{connections:h}})}}}},40108:function(e,t){"use strict";t.__esModule=!0,t.setClientTheme=t.THEMES=void 0;t.THEMES=["light","dark"];var n="#202020",o="#171717",r="#a4bad6",i=null;t.setClientTheme=function(e){if(clearInterval(i),Byond.command(".output statbrowser:set_theme "+e),i=setTimeout((function(){Byond.command(".output statbrowser:set_theme "+e)}),1500),"light"===e)return Byond.winset({"infowindow.background-color":"none","infowindow.text-color":"#000000","info.background-color":"none","info.text-color":"#000000","browseroutput.background-color":"none","browseroutput.text-color":"#000000","outputwindow.background-color":"none","outputwindow.text-color":"#000000","mainwindow.background-color":"none","split.background-color":"none","changelog.background-color":"none","changelog.text-color":"#000000","rules.background-color":"none","rules.text-color":"#000000","wiki.background-color":"none","wiki.text-color":"#000000","forum.background-color":"none","forum.text-color":"#000000","github.background-color":"none","github.text-color":"#000000","report-issue.background-color":"none","report-issue.text-color":"#000000","output.background-color":"none","output.text-color":"#000000","statwindow.background-color":"none","statwindow.text-color":"#000000","stat.background-color":"#FFFFFF","stat.tab-background-color":"none","stat.text-color":"#000000","stat.tab-text-color":"#000000","stat.prefix-color":"#000000","stat.suffix-color":"#000000","saybutton.background-color":"none","saybutton.text-color":"#000000","hotkey_toggle.background-color":"none","hotkey_toggle.text-color":"#000000","input.background-color":"#d3b5b5","input.text-color":"#000000","oocbutton.background-color":"none","oocbutton.text-color":"#000000","mebutton.background-color":"none","mebutton.text-color":"#000000","asset_cache_browser.background-color":"none","asset_cache_browser.text-color":"#000000","tooltip.background-color":"none","tooltip.text-color":"#000000"});"dark"===e&&Byond.winset({"infowindow.background-color":n,"infowindow.text-color":r,"info.background-color":n,"info.text-color":r,"browseroutput.background-color":n,"browseroutput.text-color":r,"outputwindow.background-color":n,"outputwindow.text-color":r,"mainwindow.background-color":n,"split.background-color":n,"changelog.background-color":"#494949","changelog.text-color":r,"rules.background-color":"#494949","rules.text-color":r,"wiki.background-color":"#494949","wiki.text-color":r,"forum.background-color":"#494949","forum.text-color":r,"github.background-color":"#3a3a3a","github.text-color":r,"report-issue.background-color":"#492020","report-issue.text-color":r,"output.background-color":o,"output.text-color":r,"statwindow.background-color":o,"statwindow.text-color":r,"stat.background-color":o,"stat.tab-background-color":n,"stat.text-color":r,"stat.tab-text-color":r,"stat.prefix-color":r,"stat.suffix-color":r,"saybutton.background-color":n,"saybutton.text-color":r,"hotkey_toggle.background-color":n,"hotkey_toggle.text-color":r,"input.background-color":n,"input.text-color":r,"oocbutton.background-color":n,"oocbutton.text-color":r,"mebutton.background-color":n,"mebutton.text-color":r,"asset_cache_browser.background-color":n,"asset_cache_browser.text-color":r,"tooltip.background-color":n,"tooltip.text-color":r})}},39796:function(){},12415:function(){}},t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={exports:{}};return e[o](r,r.exports,n),r.exports}n.m=e,n.x=function(){},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){var e={3:0},t=[[50539,962],[14808,962]],o=function(){},r=function(r,i){for(var a,c,s=i[0],l=i[1],d=i[2],u=i[3],g=0,h=[];g<s.length;g++)c=s[g],n.o(e,c)&&e[c]&&h.push(e[c][0]),e[c]=0;for(a in l)n.o(l,a)&&(n.m[a]=l[a]);for(d&&d(n),r&&r(i);h.length;)h.shift()();return u&&t.push.apply(t,u),o()},i=self.webpackChunktgui_workspace=self.webpackChunktgui_workspace||[];function a(){for(var o,r=0;r<t.length;r++){for(var i=t[r],a=!0,c=1;c<i.length;c++){var s=i[c];0!==e[s]&&(a=!1)}a&&(t.splice(r--,1),o=n(n.s=i[0]))}return 0===t.length&&(n.x(),n.x=function(){}),o}i.forEach(r.bind(null,0)),i.push=r.bind(null,i.push.bind(i));var c=n.x;n.x=function(){return n.x=c||function(){},(o=a)()}}();n.x()}();